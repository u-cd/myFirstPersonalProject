<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>aièªž</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-dyslexic@0.0.4/open-dyslexic.min.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div id="app-container">
        <!-- Content will be rendered by JS: login or chat UI -->
    </div>
    <script type="module">
        import { getCurrentUser, onAuthStateChange } from './auth.js';
        import { initializeLoginPage } from './login.js';
        import { initializeAuthenticatedApp } from './app.js';

        // SPA-style: show login or chat UI based on auth state
        async function renderApp() {
            // console.log('I am render app');
            const user = await getCurrentUser();
            // console.log('Supabase user:', user);
            const app = document.getElementById('app-container');

            if (!user) {
                // Load login page
                const response = await fetch('/login.html');
                const loginHTML = await response.text();
                app.innerHTML = loginHTML;

                // Initialize login functionality
                initializeLoginPage();
            } else {
                // Load authenticated app
                const response = await fetch('/app.html');
                const appHTML = await response.text();
                app.innerHTML = appHTML;

                // Initialize authenticated app functionality
                await initializeAuthenticatedApp();
            }
        }

        // Listen for auth state changes (e.g., after magic link or Google login)
        onAuthStateChange((_event, _session) => {
            // console.log('I am on auth state change');
            renderApp();
        });

        // Initial render
        renderApp();
    </script>
</body>

</html>
